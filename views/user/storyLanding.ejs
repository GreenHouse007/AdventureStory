<!-- views/user/storyLanding.ejs -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/head') %>
  </head>
  <body>
    <%- include('../partials/header', { user }) %>

    <main class="container">
      <h1><%= story?.title || 'Untitled Story' %></h1>
      <img
        src="<%= story?.coverImage || '/images/default-cover.svg' %>"
        class="cover"
        alt="Cover image for <%= story?.title || 'story' %>"
      />
      <p><%= story?.description || '' %></p>

      <% if (Array.isArray(story?.categories) && story.categories.length) { %>
      <section class="story-categories">
        <h2 class="story-categories__heading">Categories</h2>
        <ul class="tag-list">
          <% story.categories.forEach(function (cat) { %>
          <li class="tag"><%= cat %></li>
          <% }) %>
        </ul>
      </section>
      <% } %>

      <% if (progress && progress.totalEndings > 0) { %>
      <div class="ending-progress-card">
        <div class="ending-progress-card__count">
          <span class="found"><%= progress.foundCount %></span>
          <span class="divider">/</span>
          <span class="total"><%= progress.totalEndings %></span>
        </div>
        <span class="ending-progress-card__label">Endings discovered</span>
      </div>
      <% } %>

      <div class="actions stack">
        <% if (startNodeId) { %>
        <a
          href="/u/play/<%= story._id %>/<%= startNodeId %>"
          class="cta-button"
        >
          Start from Beginning
        </a>
        <% } else { %>
        <p class="muted">This story doesn't have a starting node yet.</p>
        <% } %> <% if (continueNodeId) { %>
        <a
          href="/u/play/<%= story._id %>/<%= continueNodeId %>"
          class="cta-button ghost"
        >
          Continue where you left off
        </a>
        <% } %>
      </div>
    </main>

    <%- include('../partials/footer') %>
    <style>
      .ending-progress-card {
        margin: 1.5rem 0;
        padding: 1rem 1.4rem;
        border-radius: 16px;
        background: linear-gradient(135deg, #4338ca, #6366f1);
        color: #fff;
        display: inline-flex;
        flex-direction: column;
        gap: 0.4rem;
        box-shadow: 0 16px 32px rgba(79, 70, 229, 0.25);
      }

      .ending-progress-card__count {
        font-size: 1.6rem;
        font-weight: 700;
        letter-spacing: 0.03em;
        display: inline-flex;
        align-items: baseline;
        gap: 0.35rem;
      }

      .ending-progress-card__count .divider {
        opacity: 0.8;
      }

      .ending-progress-card__label {
        font-size: 0.85rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        opacity: 0.85;
      }

      .story-categories {
        margin: 1.5rem 0 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.65rem;
      }

      .story-categories__heading {
        font-size: 0.9rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: #94a3b8;
        margin: 0;
      }
    </style>
  </body>
</html>
